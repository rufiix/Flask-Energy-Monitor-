<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Zużycie energii - demo</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h2>Zużycie energii (kWh) — dziennie</h2>
    <div id="counters"></div>
  <input id="date" type="date" />
  <button id="btn">Pokaż</button>
  <button id="csv">Pobierz CSV</button>
  <div style="width:700px;">
    <canvas id="chart"></canvas>
  </div>
  <script>
    document.getElementById('date').valueAsDate = new Date();
    let chart = null;
    document.getElementById('btn').onclick = async () => {
      const d = document.getElementById('date').value;
      const res = await fetch('/api/reports/daily?date='+d);
      const json = await res.json();
      const data = json.data || [];

      // nowa część: generowanie liczników
      const counterDiv = document.getElementById('counters');
      counterDiv.innerHTML = '';
      data.forEach(x => {
        const el = document.createElement('div');
        el.textContent = `Urządzenie ${x.name}: ${x.kwh} kWh`;
        counterDiv.appendChild(el);
      });

      // wykres Chart.js
      const labels = data.map(x => x.name);
      const values = data.map(x => +x.kwh);
      const ctx = document.getElementById('chart').getContext('2d');
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{ label: 'kWh', data: values }]
        },
        options: { responsive:true }
      });
    };
    document.getElementById('csv').onclick = () => {
      const d = document.getElementById('date').value;
      window.location = '/api/reports/daily.csv?date='+d;
    };
    // auto load today
    document.getElementById('btn').click();
  </script>
</body>
</html>
